datasets:

  - name: exp_geovals_with_lvls
    type: DataFile
    data_file: /discover/nobackup/asewnath/JediWednesday/eva/src/eva/tests/data/swell-hofx.amsua_n19-geovals.20211211T210000Z.nc4
    levels: &exp_levels 33,60
    instrument_name: amsua_n19
    variables: &exp_vars_with_lvls ['mole_fraction_of_carbon_dioxide_in_air']

  - name: exp_geovals
    type: DataFile
    data_file: /discover/nobackup/asewnath/JediWednesday/eva/src/eva/tests/data/swell-hofx.amsua_n19-geovals.20211211T210000Z.nc4
    instrument_name: amsua_n19
    variables: &exp_vars ['vegetation_area_fraction', 'leaf_area_index']

  - name: exp_latlon
    type: IodaObsSpace
    filenames:
      - /discover/nobackup/asewnath/JediWednesday/eva/src/eva/tests/data/swell-hofx.amsua_n19.20211211T210000Z.nc4
    groups:
      - name: MetaData

  - name: ctrl_geovals_with_lvls
    type: DataFile
    data_file: /discover/nobackup/asewnath/JediWednesday/eva/src/eva/tests/data/ncdiag.x0048v2-geovals.ob.PT6H.amsua_n19.2021-12-11T21:00:00Z.nc4
    levels: &ctrl_levels 33,60
    instrument_name: amsua_n19
    variables: &ctrl_vars_with_lvls ['mole_fraction_of_carbon_dioxide_in_air']

  - name: ctrl_geovals
    type: DataFile
    data_file: /discover/nobackup/asewnath/JediWednesday/eva/src/eva/tests/data/ncdiag.x0048v2-geovals.ob.PT6H.amsua_n19.2021-12-11T21:00:00Z.nc4
    instrument_name: amsua_n19
    variables: &ctrl_vars ['vegetation_area_fraction', 'leaf_area_index']

  - name: ctrl_latlon
    type: IodaObsSpace
    filenames:
      - /discover/nobackup/asewnath/JediWednesday/eva/src/eva/tests/data/ncdiag.x0048v2.ob.PT6H.amsua_n19.2021-12-11T21:00:00Z.nc4
    groups:
      - name: MetaData

transforms:

  - transform: latlon_match
    starting_latlon: ctrl_latlon
    match_latlon_to: exp_latlon
    dataset_to_modify: ctrl_geovals::amsua_n19::${variable}
    for:
      variable: *ctrl_vars

    #- transform: latlon_match
    #  starting_dataset: ctrl_geovals_with_lvls
    #  starting_latlon: ctrl_latlon
    #  match_latlon_to: exp_latlon

graphics:

  plotting_backend: Emcpy
  figure_list:
  - batch figure:
      variables: *exp_vars_with_lvls
      levels: *exp_levels
    dynamic options:
      - type: vminvmaxcmap
        level: ${level}
        data variable: exp_geovals_with_lvls::amsua_n19::${variable}
    figure:
      figure size: [20,10]
      layout: [1,1]
      title: 'Observations | AMSU-A NOAA-19 | Geovals | {level}'
      output name: map_plots/amsua_n19/${variable}/${level}/observations_amsua_n19_${variable}_${level}.png
    plots:
      - mapping:
          projection: plcarr
          domain: global
        add_map_features: ['coastline']
        add_colorbar:
          label: '${variable}'
        layers:
        - type: MapScatter
          longitude:
            variable: exp_latlon::MetaData::longitude
          latitude:
            variable: exp_latlon::MetaData::latitude
          data:
            variable: exp_geovals_with_lvls::amsua_n19::${variable}
          level: ${level}
          markersize: 2
          cmap: ${dynamic_cmap}
          vmin: ${dynamic_vmin}
          vmax: ${dynamic_vmax}

  - batch figure:
      variables: *exp_vars
    dynamic options:
      - type: vminvmaxcmap
        data variable: exp_geovals::amsua_n19::${variable}
    figure:
      figure size: [20,10]
      layout: [1,1]
      title: 'Observations | AMSU-A NOAA-19 | Geovals'
      output name: map_plots/amsua_n19/${variable}/observations_amsua_n19_${variable}.png
    plots:
      - mapping:
          projection: plcarr
          domain: global
        add_map_features: ['coastline']
        add_colorbar:
          label: '${variable}'
        layers:
        - type: MapScatter
          longitude:
            variable: exp_latlon::MetaData::longitude
          latitude:
            variable: exp_latlon::MetaData::latitude
          data:
            variable: exp_geovals::amsua_n19::${variable}
          markersize: 2
          cmap: ${dynamic_cmap}
          vmin: ${dynamic_vmin}
          vmax: ${dynamic_vmax}
