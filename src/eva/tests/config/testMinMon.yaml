# Test OznMon

diagnostics:

  # Data read
  # ---------
datasets:
  - name: experiment1
#    satellite: npp
#    sensor: ompsnp
    type: MonDataSpace
    control_file:
      - ../data/min_data/glb_allgnorm.ctl
#      - ../data/min_data/glb_reduction.ctl
    filenames:
      - ../data/min_data/2023061400.gnorms.ieee_d
#      - ../data/min_data/2023061400.reduction.ieee_d
#    regions: &regions 1
    groups:
      - name: GsiIeee
        variables: ['allgnorm', 'Iteration']
#        variables: ['reduct', 'Iteration']

transforms:
#    - transform: select time
#      new name: experiment::GsiIeee::count1
#      starting field: experiment::GsiIeee::count
#      cycle: 2015051418
#      for:
#        variable: [none]
#
#    - transform: select time
#      new name: experiment::GsiIeee::count2
#      starting field: experiment::GsiIeee::count
##      cycles: 2015051500
#      cycle: 2015051500
#      for:
#        variable: [none]
#
#    - transform: select time
#      new name: experiment::GsiIeee::count3
#      starting field: experiment::GsiIeee::count
##      cycles: 2015051506
#      cycle: 2015051506
#      for:
#        variable: [none]
#
#    - transform: select time
#      new name: experiment::GsiIeee::count4
#      starting field: experiment::GsiIeee::count
##      cycles: 2015051512
#      cycle: 2015051512
#      for:
#        variable: [none]
#
#    # Note that total is the total bias correction for a given
#    # channel/region.  To find the average divide total by count.
  - transform: arithmetic
    new name: experiment1::GsiIeee::loggnorm
    equals: log(experiment1::GsiIeee::allgnorm)
    for:
      variable: [none]

#    # Single cycle total bias correction 
#    - transform: select time
#      new name: experiment::GsiIeee::total_1cyc
#      starting field: experiment::GsiIeee::total_avg
#      cycle: 2015051512
#      for:
#        variable: [none]
#
#     # 4 cycle total bias correction using time slice    
#    - transform: select time
#      new name: experiment::GsiIeee::cnt_4cyc
#      starting field: experiment::GsiIeee::cnt
#      start cycle: 2023033012
#      end cycle: 2023033106
#      for:
#        variable: [none]


graphics:
  # Summary plots
  # ---------------
    - figure:
        layout: [1,1]
        figure size: [12,10]
        title: 'gnorms | 2023061400'
        output name: lineplots/minmon/gnorm.2023061400.png
#        output name: lineplots/minmon/reduct.2023061400.png

      plots:
        - add_xlabel: 'Iteration'
          add_ylabel: 'Gnorm'
#          add_ylabel: 'Reduction'
          add_legend:
            loc: 'upper right'
          layers:
          - type: LinePlot
            x:
              variable: experiment1::GsiIeee::Iteration
            y:
              variable: experiment1::GsiIeee::loggnorm
#              variable: experiment1::GsiIeee::reduct
            color: 'red'
            label: '2022'
#          - type: LinePlot
#            x:
#              variable: experiment::GsiIeee::channel
#            y:
#              variable: experiment::GsiIeee::count3
#            color: 'yellow'
#            label: '2015051506'
#          - type: LinePlot
#            x:
#              variable: experiment::GsiIeee::channel
#            y:
#             variable: experiment::GsiIeee::count4
#            color: 'red'
#            label: '2015051512'
#
#          - add_xlabel: 'Channel'
#            add_ylabel: 'Total Bias Correction (K)'
#            add_legend:
#              loc: 'upper right'
#            layers:
#            - type: LinePlot
#              x:
#                variable: experiment::GsiIeee::channel
#              y:
#                variable: experiment::GsiIeee::total_1cyc
#              color: 'blue'
#              label: '2015051512'
#
#            - type: LinePlot
#              x:
#                variable: experiment::GsiIeee::channel
#              y:
#                variable: experiment::GsiIeee::total_4cyc
#              color: 'red'
#              label: 'Avg last 4 cycles'
