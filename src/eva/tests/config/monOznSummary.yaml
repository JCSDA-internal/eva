#
#  Summary plots for OznMon gfs
# 
#    Make 4 plots:
#      - Obs counts from last 4 cycles
#      - Avg and sdv omgbc for 1 day, 7 days,  and 30 days
#      - Avg and sdv penalty for 1 day, 1 day, and 30 days

diagnostics:

# Data read
# ---------
datasets:
  - name: summary
    satellite: npp
    sensor: ompsnp
    type: MonDataSpace
    control_file:
      - ../data/ozn_data/time/ompsnp_npp.ges.ctl
    filenames:
      - ../data/ozn_data/time/ompsnp_npp.ges.2023082118.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023082112.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023082106.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023082100.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023082018.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023082012.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023082006.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023082000.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081918.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081912.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081906.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081900.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081818.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081812.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081806.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081800.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081718.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081712.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081706.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081700.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081618.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081612.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081606.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081600.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081518.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081512.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081506.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081500.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081418.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081412.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081406.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081400.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081318.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081312.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081306.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081300.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081218.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081212.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081206.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081200.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081118.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081112.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081106.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081100.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081018.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081012.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081006.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023081000.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080918.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080912.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080906.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080900.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080818.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080812.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080806.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080800.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080718.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080712.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080706.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080700.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080618.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080612.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080606.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080600.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080518.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080512.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080506.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080500.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080418.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080412.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080406.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080400.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080318.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080312.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080306.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080300.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080218.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080212.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080206.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080200.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080118.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080112.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080106.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023080100.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023073118.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023073112.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023073106.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023073100.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023073018.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023073012.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023073006.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023073000.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072918.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072912.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072906.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072900.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072818.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072812.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072806.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072800.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072718.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072712.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072706.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072700.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072618.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072612.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072606.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072600.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072518.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072512.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072506.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072500.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072418.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072412.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072406.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072400.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072318.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072312.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072306.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072300.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072218.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072212.ieee_d
      - ../data/ozn_data/time/ompsnp_npp.ges.2023072206.ieee_d

    levels: 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22
    regions: &regions 1
    groups:
      - name: GsiIeee
        variables: ['cnt']

transforms:
  - transform: accept where
    new name: summary::GsiIeee::nassim
    starting field: summary::GsiIeee::level_nassim
    where:
      - summary::GsiIeee::level_nassim > 0
    for:
      variable: [none]

  - transform: accept where
    new name: summary::GsiIeee::assim
    starting field: summary::GsiIeee::level_assim
    where:
      - summary::GsiIeee::level_assim > 0
    for:
      variable: [none]

  - transform: select time
    new name: summary::GsiIeee::count_cyc1
    starting field: summary::GsiIeee::cnt
    cycle: 2023082118
    for:
      variable: [none]

  - transform: select time
    new name: summary::GsiIeee::count_cyc2
    starting field: summary::GsiIeee::cnt
    cycle: 2023082112
    for:
      variable: [none]

  - transform: select time
    new name: summary::GsiIeee::count_cyc3
    starting field: summary::GsiIeee::cnt
    cycle: 2023082106
    for:
      variable: [none]

  - transform: select time
    new name: summary::GsiIeee::count_cyc4
    starting field: summary::GsiIeee::cnt
    cycle: 2023082100
    for:
      variable: [none]

#  # Note that total is the total bias correction for a given
#  # channel/region.  To find the average divide total by count.
#  - transform: arithmetic
#    new name: summary::GsiIeee::total_avg
#    equals: summary::GsiIeee::total/summary::GsiIeee::count
#    for:
#      variable: [none]
#
#  # Note that omgbc is the total omgbc for a given
#  # channel/region.  To find the average divide omgbc by count.
#  - transform: arithmetic
#    new name: summary::GsiIeee::omgbc_avg
#    equals: summary::GsiIeee::omgbc/summary::GsiIeee::count
#    for:
#      variable: [none]
#
  # Single avg obs - ges
  - transform: select time
    new name: summary::GsiIeee::avgomg_1
    starting field: summary::GsiIeee::avgomg
    cycle: 2023082118
    for:
      variable: [none]

  # Single sdv obs - ges
  - transform: select time
    new name: summary::GsiIeee::sdvomg_1
    starting field: summary::GsiIeee::sdvomg
    cycle: 2023082118
    for:
      variable: [none]

  # avg obs-ges, 1 day
  - transform: select time
    new name: summary::GsiIeee::avgomg_1d
    starting field: summary::GsiIeee::avgomg
    start cycle: 2023082118
    end cycle: 2023082100
    for:
      variable: [none]

  # sdv obs-ges, 1 day
  - transform: select time
    new name: summary::GsiIeee::sdvomg_1d
    starting field: summary::GsiIeee::sdvomg
    start cycle: 2023082118
    end cycle: 2023082100
    for:
      variable: [none]

  # avg obs-ges, 30 day
  - transform: select time
    new name: summary::GsiIeee::avgomg_30d
    starting field: summary::GsiIeee::avgomg
    start cycle: 2023082118
    end cycle: 2023072206
    for:
      variable: [none]

  # sdv obs-ges, 30 day
  - transform: select time
    new name: summary::GsiIeee::sdvomg_30d
    starting field: summary::GsiIeee::sdvomg
    start cycle: 2023082118
    end cycle: 2023072206
    for:
      variable: [none]

  # cpen, 1 cycle
  - transform: select time
    new name: summary::GsiIeee::cpen_1c
    starting field: summary::GsiIeee::cpen
    cycle: 2023082118
    for:
      variable: [none]

  # cpen, 1 day
  - transform: select time
    new name: summary::GsiIeee::cpen_1d
    starting field: summary::GsiIeee::cpen
    start cycle: 2023082118
    end cycle: 2023082100
    for:
      variable: [none]

  # cpen, 30 day
  - transform: select time
    new name: summary::GsiIeee::cpen_30d
    starting field: summary::GsiIeee::cpen
    start cycle: 2023082118
    end cycle: 2023072206
    for:
      variable: [none]

  - transform: arithmetic
    new name: summary::GsiIeee::yaxis_100
    equals: summary::GsiIeee::level_yaxis_z + 100.0
    for:
      variable: [none]
    
  - transform: arithmetic
    new name: summary::GsiIeee::yaxis_np5
    equals: summary::GsiIeee::level_yaxis_z + -1.5
    for:
      variable: [none]
    
  - transform: arithmetic
    new name: summary::GsiIeee::yaxis_n5
    equals: summary::GsiIeee::level_yaxis_z + -5.0
    for:
      variable: [none]
    

#  # 30 day omgbc using time/slice
#  - transform: select time
#    new name: summary::GsiIeee::omgbc_30d
#    starting field: summary::GsiIeee::omgbc_avg
#    start cycle: 2023070218
#    end cycle: 2023060300
#    for:
#      variable: [none]
#
#  # Note that penalty is the total penalty for a given
#  # channel/region.  To find the average divide penalty by count.
#  - transform: arithmetic
#    new name: summary::GsiIeee::penalty_avg
#    equals: summary::GsiIeee::penalty/summary::GsiIeee::count
#    for:
#      variable: [none]
#
#  # 1 cycle penalty using time/slice
#  - transform: select time
#    new name: summary::GsiIeee::penalty_1c
#    starting field: summary::GsiIeee::penalty_avg
#    cycle: 2023070218
#    for:
#      variable: [none]
#
#  # 1 day penalty using time/slice
#  - transform: select time
#    new name: summary::GsiIeee::penalty_1d
#    starting field: summary::GsiIeee::penalty_avg
#    start cycle: 2023070218
#    end cycle: 2023070200
#    for:
#      variable: [none]
#
#  # 30 day penalty using time/slice
#  - transform: select time
#    new name: summary::GsiIeee::penalty_30d
#    starting field: summary::GsiIeee::penalty_avg
#    start cycle: 2023070218
#    end cycle: 2023060300
#    for:
#      variable: [none]
#
graphics:

    - figure:
        layout: [3,1]
        figure size: [20,18]
        tight layout:
        title: "Summary Plot ompsnp_npp \n Valid: 2023082118"
        output name: lineplots/ompsnp_npp/summary.ompsnp_npp.png
        plot logo:
          which: 'noaa/nws'
          loc: 'upper left'
          subplot_orientation: 'first'
      plots:
        # Obs counts, last 4 cycles
        # -------------------------
        - add_xlabel: 'Level'
          add_ylabel: 'Observation Count'
          add_legend:
            loc: 'upper right'
          set_xticks: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]
          set_yticks: [100, 150, 200, 250, 300, 350, 400]
          add_grid:
            axis: 'both'
            linestyle: 'dotted'
            linewidth: 0.25
            color: 'black'
          add_title: 
            label: "Number of Obs Passing QC \n 2023082118"
            loc: 'Left'
          layers:
          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::count_cyc1
            color: 'blue'
            label: '2023082118'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::count_cyc2
            color: 'green'
            label: '2023082112'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::count_cyc3
            color: 'orange'
            label: '2023082106'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::count_cyc4
            color: 'red'
            label: '2023082100'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::assim
            y: 
              variable: summary::GsiIeee::yaxis_100
            color: 'green'
            label: 'level assim'
            linestyle: ''
            marker: 's'
            markersize: '6'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::nassim
            y: 
              variable: summary::GsiIeee::yaxis_100
            color: 'red'
            label: 'chan not assim'
            linestyle: ''
            marker: 's'
            markersize: '6'

        # obs-ges, avg and sdv, 1 cycle, 1 day, 30 days
        # --------------------------------------------------
        - add_xlabel: 'Level'
          add_ylabel: 'Obs-Ges'
          add_legend:
            loc: 'upper left'
          set_xticks: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]
          add_grid:
            axis: 'both'
            linestyle: 'dotted'
            linewidth: 0.25
            color: 'black'
          add_title: 
            label: "Obs-Ges\n 2023082118"
            loc: 'Left'
          layers:
          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::avgomg_1
            color: 'blue'
            label: 'avg 1 cycle'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::avgomg_1d
            color: 'green'
            label: 'avg 1 day'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::avgomg_30d
            color: 'purple'
            label: 'avg 30 days'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::sdvomg_1
            color: 'red'
            label: 'sdv 1 cycle'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::sdvomg_1d
            color: 'orange'
            label: 'sdv 1 day'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::sdvomg_30d
            color: 'yellow'
            label: 'sdv 30 day'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::assim
            y: 
              variable: summary::GsiIeee::yaxis_n5
            color: 'green'
            label: 'chan assim'
            linestyle: ''
            marker: 's'
            markersize: '6'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::nassim
            y: 
              variable: summary::GsiIeee::yaxis_n5
            color: 'red'
            label: 'chan not assim'
            linestyle: ''
            marker: 's'
            markersize: '6'

          - type: HorizontalLine
            y: 0
            linewidth: 0.75
            label: ''

        # Contribution to Penalty, 1 cycle, 1 day, 30 days
        # ------------------------------------------------
        - add_xlabel: 'Level'
          add_ylabel: 'Contribution to Penalty'
          add_legend:
            loc: 'upper left'
          set_xticks: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]
          add_grid:
            axis: 'both'
            linestyle: 'dotted'
            linewidth: 0.25
            color: 'black'
          add_title: 
            label: "Contribution to Penalty\n 2023082118"
            loc: 'Left'
          layers:

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::cpen_1c
            color: 'blue'
            label: '1 cycle'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::cpen_1d
            color: 'green'
            label: '1 day'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::level
            y:
              variable: summary::GsiIeee::cpen_30d
            color: 'red'
            label: '30 days'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::assim
            y: 
              variable: summary::GsiIeee::yaxis_np5
            color: 'green'
            label: 'chan assim'
            linestyle: ''
            marker: 's'
            markersize: '6'

          - type: LinePlot
            x:
              variable: summary::GsiIeee::nassim
            y: 
              variable: summary::GsiIeee::yaxis_np5
            color: 'red'
            label: 'chan not assim'
            linestyle: ''
            marker: 's'
            markersize: '6'

